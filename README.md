# 着座検知・集中力測定デバイス


![デバイス写真-2](https://user-images.githubusercontent.com/50434558/98461820-b8bb0a80-21f2-11eb-84b9-a4440f1039c4.jpg)

## 概要
　本デバイスは，加速度センサおよび気圧センサを用いてユーザーが着座しているかどうか検知し，着座している場合にはどの程度作業に集中しているかを測定する座布団型デバイスである．なお，測定結果は，本アプリ専用のデータベース（[F_2004](https://github.com/jphacks/F_2004)）に5分ごとにPOSTリクエストによって送信する．
 
＊ 本デバイスの利用方法は本アプリの[紹介動画](https://youtu.be/IdvRumHTEvc)でも確認できる．

## POST Request
　MIME typeは"application/x-www-form-urlencoded"を用い，5分ごとに以下のフォーマットで測定したデータをサーバーに送信する．

| key | description |
| ------------- | ------------- |
| "user-id"  | ユーザID |
| "concentration_value"  | 集中レベル |
| "is_sitting"  | 着座状況 |

## 使用方法
　本デバイスの構成要素と使用時の外観を下図に示す．本デバイスは基板の入った袋の様な外観をしており，袋の中に本体である基板と給電用のモバイルバッテリーが入っている．使用するにはまずモバイルバッテリーと基板が接続し，基板に給電していることを確認する．基板の部分は椅子の背もたれに近くユーザーが踏まない箇所に固定する．そして，ユーザーが袋の上に着座して作業を行うことで使用できる．使用しないときにはモバイルバッテリーの給電を停止するか基板との接続を解除する．なお，集中力の測定方法は[文献[1]](http://www.wiss.org/WISS2008Proceedings/posters/paper0038.pdf)を参考にしており，条件を合わせるためにも使用する椅子はキャリー椅子であることが望ましく，さらに可能であれば基板を背もたれに固定するとよい．



 
 **構成要素**
 
![デバイス写真-4](https://user-images.githubusercontent.com/50434558/98461843-ec963000-21f2-11eb-8366-78c273a2e421.jpg)
 
 **使用時の外観**
 
![デバイス写真-3](https://user-images.githubusercontent.com/50434558/98461826-c7a1bd00-21f2-11eb-8e7d-e790cae70e3a.jpg)
　
## 機能詳細

* 集中力測定  
　本デバイスは，大久保らの加速度センサを利用した集中度合推定システムに関する研究（[1]）を参考にして集中力を推定している．大久保らの研究では，キャリー椅子の背もたれに装着した加速度センサのパワースペクトルの和と集中度に負の相関があることを示しており，本アプリにおいてもパワースペクトルの和を集中力を測定する際の指標として用いている．本アプリでは，加速度センサMPU-6050を使用し，パワースペクトルの和（二乗平均値）が2.0[G^2]であったときを上限，静止状態の理想値である1.0[G^2]であったときを下限として，測定されたパワースペクトルの和が上限と下限の間を10分割したときに何段階目に属するかを計算するすることによって集中力を10段階で測定している．

* 着座検知  
　着座検知に際しては，Infineon社に提供して頂いた気圧センサDPS310を利用しており，袋の中の気圧が100100.00[Pa]を超えると，ユーザ―が着座していると判断している．
 (気圧は標高によって変化するため，ユーザーがとこにいて，どんな形状の袋を使用していても着座検知できるようにアルゴリズムを改良する必要がある．）

## セットアップ方法
### 基板の作製
　本デバイスの基板の外観と配線図を以下に示す．配線図に従いESP32 DevKitC ESP-WROOM-32 開発ボード（以下，esp32），加速度センサGY-521（MPU-6050），気圧センサShield2Go pressure DPS310を配線する．


 **基板**
 
![デバイス写真-1](https://user-images.githubusercontent.com/50434558/98461814-a8a32b00-21f2-11eb-95d8-9074ecb4b546.jpg)

 **配線図**
 
 ![配線図](https://user-images.githubusercontent.com/50434558/98437266-39f79c00-2124-11eb-94aa-d2594b407a95.jpg)

### プログラム書き込み
1. Device.inoの上から二行目と三行目にあるSSIDとパスワードを自分のWiFiのものに設定する．
2. User-idも好きな番号に変更する．
3. Arduino IDEを利用してesp32に書き込む．

ただし，Arduino IDEを用いて書き込みを行う際には事前に以下の設定が必要．
* [Arduino core for the ESP32](https://github.com/espressif/arduino-esp32)によるesp32の開発環境構築．
* [DPS3210開発用ライブラリ](https://github.com/Infineon/DPS310-Pressure-Sensor)の取得．

## 参考文献
[[1] 大久保　雅史，藤村　安那："加速度センサーを利用した集中度合い推定システムの提案"，WISS2008，2008](http://www.wiss.org/WISS2008Proceedings/posters/paper0038.pdf)

